<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://code.jquery.com/jquery-1.6.4.js"></script>
    <title>情報表示モニター</title>
  </head>
  <body>
    <div id="attend1" style="display: none;">
      <img src="./在席.png">
    </div>
    <div id="attend2" style="display: none;">
      <img src="./離席.gif">
    </div>
    <div id="eew" style="display: none;">
      <img src="./eew.gif">
    </div>
    <div id="tsunami1" style="display: none;">
      <img src="./津波1.png">
    </div>
    <div id="tsunami2" style="display: none;">
      <img src="./津波2.png">
    </div>
    <div id="quake" style="display: none;">
      <img src="./地震1.png">
    </div>
    <div id="tsunamiNotifycation" style="display: none;">
      <img src="./津波1(通知).png">
    </div>
    <div id="error" style="display: none;">
      <img src="./不具合1.png">
    </div>
    <script>
      window.setInterval(check, 1000);
      var attend,eew,tsunami,quake,tsunamiNotify,error = "";
      var num = 0;
      var num2 = false;
      error = false
      function check(){
        try{
          num++
          if(num2 === false){
            num2 = true
            return
          }
          var url = 'https://script.google.com/macros/s/AKfycbyD8llwZGIAZ8Dqvs7uv0LgHjDR45oCj95OvP8LLzLCkg0JEeXWElrS9ex7GutPlB70/exec';
          fetch(url)
            .then(response => response.json())
            .then(data => {
              attend = data.value;
              console.log(data[0].value)
              if(data[0].value === "Yes"){
                document.getElementById("attend1").style.display = "block"
                document.getElementById("attend2").style.display = "none"
                document.getElementById("error").style.display = "none"
              }else if(data[0].value === "No"){
                document.getElementById("attend1").style.display = "none"
                document.getElementById("attend2").style.display = "block"
                document.getElementById("error").style.display = "none"
              }else{
                throw "Error";
              }  
            });
          if(num === 3){
            num = 0;
            url = 'https://api.p2pquake.net/v2/history?codes=556';
            fetch(url)
              .then(response => response.json())
              .then(data => {
                if(eew !== data[0].id){
                  eew = data[0].id;
                  console.log(data[0].id + "/" + eew)
                  document.getElementById("attend1").style.display = "none"
                  document.getElementById("attend2").style.display = "none"
                  document.getElementById("eew").style.display = "block"
                  document.getElementById("tsunami1").style.display = "none"
                  document.getElementById("tsunami2").style.display = "none"
                  document.getElementById("quake").style.display = "none"
                  document.getElementById("tsunamiNotifycation").style.display = "none"
                  document.getElementById("error").style.display = "none"
                }else{
                  document.getElementById("eew").style.display = "none"
                }
              });
            //津波(tsunami1,tsunami2)
            url = 'https://api.p2pquake.net/v2/history?codes=552&limit=1';
            fetch(url)
              .then(response => response.json())
              .then(data => {
                if(data[0]){
                  if(tsunami !== data[0].id){
                    tsunami = data[0].id;
                    console.log(data[0].id + "/" + tsunami)
                    if(data[0].area){
                      if(data[0].areas[0].grade === "MajorWarning"){
                        document.getElementById("attend1").style.display = "none"
                        document.getElementById("attend2").style.display = "none"
                        document.getElementById("eew").style.display = "none"
                        document.getElementById("tsunami1").style.display = "block"
                        document.getElementById("tsunami2").style.display = "none"
                        document.getElementById("quake").style.display = "none"
                        document.getElementById("tsunamiNotifycation").style.display = "none"
                        document.getElementById("error").style.display = "none"
                      }else if(data[0].areas[0].grade === "Warning"){
                        document.getElementById("attend1").style.display = "none"
                        document.getElementById("attend2").style.display = "none"
                        document.getElementById("eew").style.display = "none"
                        document.getElementById("tsunami1").style.display = "none"
                        document.getElementById("tsunami2").style.display = "block"
                        document.getElementById("quake").style.display = "none"
                        document.getElementById("tsunamiNotifycation").style.display = "none"
                        document.getElementById("error").style.display = "none"
                      }else{
                        document.getElementById("tsunami1").style.display = "none"
                        document.getElementById("tsunami2").style.display = "none"
                      }
                    }else{
                      document.getElementById("tsunami1").style.display = "none"
                      document.getElementById("tsunami2").style.display = "none"
                    }
                  }else{
                    document.getElementById("tsunami1").style.display = "none"
                    document.getElementById("tsunami2").style.display = "none"
                  }
                }else{
                  document.getElementById("tsunami1").style.display = "none"
                  document.getElementById("tsunami2").style.display = "none"
                }
              });
            url = 'https://api.p2pquake.net/v2/history?codes=551&limit=1';
            fetch(url)
              .then(response => response.json())
              .then(data => {
                if(eew !== data[0].id){
                  if(data[0].earthquake.maxScale <= 70){
                    quake = data[0].id;
                    console.log(data[0].id + "/" + quake)
                    document.getElementById("attend1").style.display = "none"
                    document.getElementById("attend2").style.display = "none"
                    document.getElementById("eew").style.display = "none"
                    document.getElementById("tsunami1").style.display = "none"
                    document.getElementById("tsunami2").style.display = "none"
                    document.getElementById("quake").style.display = "block"
                    document.getElementById("tsunamiNotifycation").style.display = "none"
                    document.getElementById("error").style.display = "none"
                  }else{
                    document.getElementById("quake").style.display = "none"
                  }
                }else{
                  document.getElementById("quake").style.display = "none"
                }
              });
            }
        }catch(e){
          document.getElementById("attend1").style.display = "none"
          document.getElementById("attend2").style.display = "none"
          document.getElementById("eew").style.display = "none"
          document.getElementById("tsunami1").style.display = "none"
          document.getElementById("tsunami2").style.display = "none"
          document.getElementById("quake").style.display = "none"
          document.getElementById("tsunamiNotifycation").style.display = "none"
          document.getElementById("error").style.display = "block"
        }
      }
    </script>
  </body>
</html>
