<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://code.jquery.com/jquery-1.6.4.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.js" defer></script>
    <title>情報表示モニター</title>
  </head>
  <body>
    <style>
      img{
        height: 345px;
        padding-top: 2px;
      }
    </style>
    <div onclick="openFullscreen();">
      <h2 id="battery" style="background-color:#000000cf;position: absolute;z-index: 10000;color: white; padding: 5px; margin: 0;"></h2>
      <div id="attend1" style="display: none;position: absolute;z-index: 1;">
        <img src="./在席.png">
      </div>
      <div id="attend2" style="display: none;position: absolute;z-index: 1;">
        <img src="./離席.gif">
      </div>
      <div id="eew" style="display: none;position: absolute;z-index: 10;" onclick="eewStop()">
        <img src="./eew.gif">
      </div>
      <div id="tsunami1" style="display: none;position: absolute;z-index: 10;" onclick="tsuanmiStop()">
        <img src="./津波1.png">
      </div>
      <div id="tsunami2" style="display: none;position: absolute;z-index: 10;" onclick="tsunamiStop()">
        <img src="./津波2.png">
      </div>
      <div id="quake" style="display: none;position: absolute;z-index: 10;" onclick="quakeStop()">
       <img src="./地震1.png">
      </div>
      <div id="tsunamiNotifycation" style="display: none;position: absolute;z-index: 10;">
        <img src="./津波1(通知).png">
      </div>
      <div id="error" style="display: none;position: absolute;z-index: 1;" onclick="errorStop()">
        <img src="./不具合1.png">
      </div>
    </div>
    <script>
      window.setInterval(check, 1000);
      var attend,eew,tsunami,quake,tsunamiNotify,error = "";
      var num = 0;
      var num2 = false;
      error = false
      function requestFullscreen(elem) {
        // 全画面表示をリクエストするメソッドを取得
        const method = elem.requestFullscreen || elem.webkitRequestFullscreen || elem.mozRequestFullScreen || elem.msRequestFullscreen;
        if (method) {
          method.call(elem); // 全画面表示をリクエスト
        }
      }

      function openFullscreen() {
        const elem = document.documentElement;
        requestFullscreen(elem);
      }
      function check(){
        try{
          num++
          if(num2 === false || num2 === true){
            var url = 'https://script.google.com/macros/s/AKfycbyD8llwZGIAZ8Dqvs7uv0LgHjDR45oCj95OvP8LLzLCkg0JEeXWElrS9ex7GutPlB70/exec';
            fetch(url)
              .then(response => response.json())
              .then(data => {
                console.log(data[0].value)
                if(attend !== data[0].value){
                  attend = data[0].value;
                  if(data[0].value === "Yes"){
                    document.getElementById("attend1").style.display = "block"
                    document.getElementById("attend2").style.display = "none"
                    document.getElementById("error").style.display = "none"
                    const notifycation = new Howl({
                      src: 'https://saigaikinkyuu.github.io/device_info/audio/notifycation.mp3',
                      autoplay: true,
                      volume: 1,
                      loop: false
                    });
                  notifycation.play();
                  }else if(data[0].value === "No"){
                    document.getElementById("attend1").style.display = "none"
                    document.getElementById("attend2").style.display = "block"
                    document.getElementById("error").style.display = "none"
                    const notifycation = new Howl({
                      src: 'https://saigaikinkyuu.github.io/device_info/audio/notifycation.mp3',
                      autoplay: true,
                      volume: 2,
                      loop: false
                    });
                    notifycation.play();
                  }else{
                    document.getElementById("attend1").style.display = "none"
                    document.getElementById("attend2").style.display = "none"
                    document.getElementById("eew").style.display = "none"
                    document.getElementById("tsunami1").style.display = "none"
                    document.getElementById("tsunami2").style.display = "none"
                    document.getElementById("quake").style.display = "none"
                    document.getElementById("tsunamiNotifycation").style.display = "none"
                    document.getElementById("error").style.display = "block"
                 }
                }
              });
            if(num === 3){
              num = 0;
              url = 'https://api.p2pquake.net/v2/history?codes=556';
              fetch(url)
                .then(response => response.json())
                .then(data => {
                  if(eew !== data[0].id){
                    eew = data[0].id;
                    if(num2 === true){
                      document.getElementById("eew").style.display = "block"
                      document.getElementById("tsunami1").style.display = "none"
                      document.getElementById("tsunami2").style.display = "none"
                      document.getElementById("quake").style.display = "none"
                      document.getElementById("tsunamiNotifycation").style.display = "none"
                      document.getElementById("error").style.display = "none"
                      const eewN = new Howl({
                        src: 'https://saigaikinkyuu.github.io/device_info/audio/緊急地震速報(一般者向け).mp3',
                        autoplay: true,
                        volume: 2,
                        loop: true
                      });
                      eewN.play();
                      function eewStop(){
                        eewN.stop();
                      }
                    }
                  }else{
                    document.getElementById("eew").style.display = "none"
                  }
                });
              //津波(tsunami1,tsunami2)
              url = 'https://api.p2pquake.net/v2/history?codes=552&limit=1';
              fetch(url)
                .then(response => response.json())
                .then(data => {
                  if(data[0]){
                    if(tsunami !== data[0].id){
                      tsunami = data[0].id;
                      const tsunamiN = new Howl({
                        src: 'https://saigaikinkyuu.github.io/device_info/audio/エリアメール(津波).mp3',
                        autoplay: true,
                        volume: 2,
                        loop: true
                      });
                      console.log(data[0].id + "/" + tsunami)
                      if(data[0].area){
                        if(data[0].areas[0].grade === "MajorWarning"){
                            if(num2 === true){
                              document.getElementById("eew").style.display = "none"
                              document.getElementById("tsunami1").style.display = "block"
                              document.getElementById("tsunami2").style.display = "none"
                              document.getElementById("quake").style.display = "none"
                              document.getElementById("tsunamiNotifycation").style.display = "none"
                              document.getElementById("error").style.display = "none"
                              tsunamiN.play();
                              function tsunamiStop(){
                                tsunamiN.stop();
                              }
                            }
                        }else if(data[0].areas[0].grade === "Warning"){
                            if(num2 === true){
                              document.getElementById("eew").style.display = "none"
                              document.getElementById("tsunami1").style.display = "none"
                              document.getElementById("tsunami2").style.display = "block"
                              document.getElementById("quake").style.display = "none"
                              document.getElementById("tsunamiNotifycation").style.display = "none"
                              document.getElementById("error").style.display = "none"
                              tsunamiN.play();
                              function tsunamiStop(){
                                tsunamiN.stop();
                              }
                            }
                        }else{
                          document.getElementById("tsunami1").style.display = "none"
                          document.getElementById("tsunami2").style.display = "none"
                        }
                      }else{
                        document.getElementById("tsunami1").style.display = "none"
                        document.getElementById("tsunami2").style.display = "none"
                      }
                    }else{
                      document.getElementById("tsunami1").style.display = "none"
                      document.getElementById("tsunami2").style.display = "none"
                    }
                  }else{
                    document.getElementById("tsunami1").style.display = "none"
                    document.getElementById("tsunami2").style.display = "none"
                  }
                });
              url = 'https://api.p2pquake.net/v2/history?codes=551&limit=1';
              fetch(url)
                .then(response => response.json())
                .then(data => {
                  if(quake !== data[0].id){
                    if(data[0].earthquake.maxScale <= 70){
                      quake = data[0].id;
                      if(num2 === true){
                        console.log(data[0].id + "/" + quake)
                        document.getElementById("eew").style.display = "none"
                        document.getElementById("tsunami1").style.display = "none"
                        document.getElementById("tsunami2").style.display = "none"
                        document.getElementById("quake").style.display = "block"
                        document.getElementById("tsunamiNotifycation").style.display = "none"
                        document.getElementById("error").style.display = "none"
                        const quakeN = new Howl({
                          src: 'https://saigaikinkyuu.github.io/device_info/audio/NHK臨時放送開始音.mp3',
                          autoplay: true,
                          volume: 2,
                          loop: true
                        });
                        quakeN.play();
                        function quakeStop(){
                          quakeN.stop();
                        }
                      }
                    }else{
                      document.getElementById("quake").style.display = "none"
                    }
                  }else{
                    document.getElementById("quake").style.display = "none"
                  }
                });
              console.log(num2)
              if(num2 === false){
                num2 = true;
              }
            }
          }
        }catch(e){
          console.error(e.message)
          document.getElementById("eew").style.display = "none"
          document.getElementById("tsunami1").style.display = "none"
          document.getElementById("tsunami2").style.display = "none"
          document.getElementById("quake").style.display = "none"
          document.getElementById("tsunamiNotifycation").style.display = "none"
          document.getElementById("error").style.display = "block"
          const errorN = new Howl({
            src: 'https://saigaikinkyuu.github.io/device_info/audio/error.mp3',
            autoplay: true,
            volume: 1,
            loop: true
          });
          errorN.play();
          function errorStop(){
            errorN.stop();
          }
        }
      }
    </script>
    <script>
      navigator.getBattery().then(function(battery) {
        document.getElementById('battery').innerHTML = battery.level*100 + "%";
      });
    </script>
  </body>
</html>
